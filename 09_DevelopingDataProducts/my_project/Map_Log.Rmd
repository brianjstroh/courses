---
title: "Map Log"
author: "Brian Stroh"
date: "October 29, 2018"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(shiny)
library(leaflet)
library(dplyr)
library(data.table)

```


```{r shiny, echo = FALSE}
my_addresses <- data.frame(Label="testlabel",
                             Streets="teststreet",
                             City="testcity", 
                             State="teststate",  
                             Zip="testzip", 
                             URL="testURL",
                             longitude = .1,
                             latitude = -0.1,
                             stringsAsFactors=FALSE) 
#my_addresses <- data.frame(Label=character(),
#                             Streets=character(),
#                             City=character(), 
#                             State=character(),  
#                             Zip=character(), 
#                             URL=character(),
#                             longitude = .1,
#                             latitude = -0.1,
#                             stringsAsFactors=FALSE) 

#my_addresses[1,]<-c("testlabel","teststreet","testcity","teststate","testzip","testurl.com")

ui <- fluidPage(pageWithSidebar(
            headerPanel(""),
            sidebarPanel(
                    textInput("label","Address Label","-"),
                    textInput("street","Street Address","-"),
                    textInput("city","City","-"),
                    textInput("state","State","-"),
                    textInput("zip","Zip Code","-"),
                    textInput("url","HyperLink","-"),
                    textInput("long","Longitude","-"),
                    textInput("lat","Latitude","-"),
                    actionButton("add", "Add Location")
              ),
            mainPanel(
                  tabsetPanel(
                        tabPanel("Current Logged Locations",
                                leafletOutput("map")
                        ),
                        tabPanel("Logged Location Table",
                                dataTableOutput("address_table")
                        )
                  )
            )
))
server <- function(input, output, session) {
      my_addresses <- reactiveValues()
      my_addresses$data <- data.table(latitude = rnorm(40) * 2 + 13,longitude= rnorm(40) + 48)
            
        mydf <- reactive({
              
            #new_row=data.frame(
            #      longitude=input$long,
            #      latitude=input$lat)
            #my_addresses<-rbind(my_addresses,new_row)
            #select(my_addresses$data, longitude, latitude)
            my_addresses$data
        })
        
        observeEvent(input$add,{
            new_row=data.frame(
                  latitude=as.double(input$lat),
                  longitude=as.double(input$long))
            my_addresses$data<-rbind(my_addresses$data,new_row)
        })
      
        output$map <- renderLeaflet({
          leaflet() %>%
            addTiles() %>%
            addMarkers(data = my_addresses$data)
        })
        
        
        output$address_table<-renderDataTable(mydf())
      }

shinyApp(ui, server, options = list(height = 1300))
```
